# RAG 시스템 사용 가이드

## 개요
RAG (Retrieval-Augmented Generation) 시스템은 PROK 헌법 PDF 파일들을 자동으로 참조하여 더 정확하고 관련성 높은 답변을 제공하는 기능입니다.

## 주요 기능

### 1. 문서 참조 시스템
- **헌법.pdf**: 한국기독교장로회 헌법 전문
- **교회정치.pdf**: 교회 정치 관련 규정
- **예배모범.pdf**: 예배 모범 및 절차
- **권징조례.pdf**: 권징 관련 조례
- **총회실행위원회규정.pdf**: 총회 실행위원회 규정

### 2. 설정 방법

#### RAG 시스템 활성화
1. ⚙️ 설정 버튼 클릭
2. "문서 참조 시스템 (RAG)" 섹션에서 "RAG 시스템 사용" 토글 활성화
3. 참조할 문서들을 체크박스로 선택
4. "설정 저장" 버튼 클릭

#### API 키 설정
1. OpenAI API 키 입력 (sk-로 시작하는 키)
2. "API 테스트" 버튼으로 연결 확인
3. 설정 저장

### 3. 작동 원리

#### 텍스트 추출
- PDF.js를 사용하여 PDF 파일에서 텍스트 추출
- 각 문서를 1000자 단위로 청크 분할
- 청크 간 200자 중복으로 문맥 유지

#### 임베딩 생성
- OpenAI의 text-embedding-ada-002 모델 사용
- 각 청크를 벡터로 변환하여 저장

#### 유사도 검색
- 사용자 질문을 임베딩으로 변환
- 코사인 유사도로 관련 청크 검색
- 상위 3개 청크를 컨텍스트로 사용

#### 답변 생성
- 검색된 관련 문서 내용을 ChatGPT에 전달
- 문서 기반 정확한 답변 생성

### 4. 장점

#### 정확성 향상
- 실제 헌법 문서 내용 기반 답변
- 최신 정보 반영 가능
- 구체적인 조항 인용

#### 사용자 경험
- 자동 문서 참조로 수동 검색 불필요
- 관련성 높은 답변 제공
- 설정으로 문서 선택 가능

### 5. 주의사항

#### 파일 위치
- PDF 파일들은 `pdfs/` 폴더에 위치해야 함
- 파일명은 정확히 일치해야 함:
  - 헌법.pdf
  - 교회정치.pdf
  - 예배모범.pdf
  - 권징조례.pdf
  - 총회실행위원회규정.pdf

#### API 비용
- 임베딩 생성 시 API 비용 발생
- 문서 크기에 따라 비용 증가 가능
- 초기화 시에만 임베딩 생성

#### 성능
- 첫 사용 시 초기화 시간 소요
- 문서 크기에 따라 로딩 시간 증가
- 브라우저 메모리 사용량 증가

### 6. 문제 해결

#### PDF 로드 실패
- 파일 경로 확인
- 파일 존재 여부 확인
- 브라우저 콘솔에서 오류 메시지 확인

#### RAG 시스템 초기화 실패
- API 키 유효성 확인
- 네트워크 연결 확인
- 선택된 문서 확인

#### 답변 품질 저하
- 더 많은 문서 선택
- 시스템 프롬프트 조정
- 문서 업데이트 확인

### 7. 고급 설정

#### 청크 크기 조정
- 기본값: 1000자
- 큰 문서: 1500자
- 작은 문서: 500자

#### 검색 결과 수 조정
- 기본값: 상위 3개 청크
- 정확도 향상: 상위 5개
- 속도 향상: 상위 1개

#### 임베딩 모델 변경
- 기본값: text-embedding-ada-002
- 고성능: text-embedding-3-small
- 최신: text-embedding-3-large

## 기술 스택
- **PDF 처리**: PDF.js
- **임베딩**: OpenAI Embeddings API
- **검색**: 코사인 유사도
- **생성**: OpenAI ChatGPT API
- **저장**: 브라우저 메모리 (세션별)

## 업데이트 계획
- [ ] 벡터 데이터베이스 연동
- [ ] 문서 버전 관리
- [ ] 실시간 문서 업데이트
- [ ] 다국어 지원
- [ ] 음성 입력 지원 